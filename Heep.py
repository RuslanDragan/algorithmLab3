def swap(arr, i, j):

    arr[i], arr[j] = arr[j], arr[i]

def sink(arr, i, n):

    k = i
    while True:
        j = 2 * k + 1  # Індекс лівого дочірнього елемента
        
        # Перевіряємо, чи існує лівий дочірній елемент
        if j >= n:
            break
        
        # Знаходимо індекс найбільшого дочірнього елемента
        if j + 1 < n and arr[j + 1] > arr[j]:
            j += 1
        
        # Якщо поточний елемент більший або дорівнює найбільшому дочірньому
        if arr[k] >= arr[j]:
            break
        
        # Міняємо місцями та продовжуємо занурення
        swap(arr, k, j)
        k = j

def heapsort(arr):

    n = len(arr)
    print(f"Початковий масив: {arr}\n")
    
    # Фаза 1: Побудова максимальної купи
    print("--- Фаза 1: Побудова максимальної купи ---")
    
    for i in range(n // 2 - 1, -1, -1):
        print(f"Занурюємо елемент з індексу {i}: {arr[i]}")
        sink(arr, i, n)
    
    print(f"\nМасив після побудови купи: {arr}\n")
    
    # Фаза 2: Сортування
    print("--- Фаза 2: Сортування ---")
    
    for i in range(n - 1, 0, -1):
        print(f"Міняємо місцями корінь ({arr[0]}) та останній елемент ({arr[i]})")
        swap(arr, 0, i)
        
        n -= 1 
        print(f"Розмір купи зменшився до {n}. Відновлюємо властивості купи.")
        sink(arr, 0, n)
        print(f"Maсив на поточному кроці: {arr}\n")
        
    return arr

try:
    # Запит на введення масиву з клавіатури у новому форматі
    input_string = input("Введіть елементи масиву через кому (напр. 47, 50, 61, 41): ")
    

    # Розділяє рядок по комі, прибирає пробіли .strip() і перетворює на число
    A = [int(item.strip()) for item in input_string.split(',')]
    
    if not A:
        print("Помилка: масив не може бути порожнім.")
    else:
        # Виклик функції сортування
        sorted_A = heapsort(A)
        print(f"Відсортований масив: {sorted_A}")

except ValueError:
    print("Помилка: Вводити можна лише цілі числа, розділені комою.")
except Exception as e:
   print(f"Сталася неочікувана помилка: {e}")
